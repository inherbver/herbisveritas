# Internationalization (i18n) with next-intl

This document outlines key aspects and learnings related to the `next-intl` setup in this project.

## Core Setup

- **Locales Supported**: English (`en`), French (`fr`). Default: `fr`.
- **Message Files**:
  - Global/shared translations: `src/i18n/messages/[locale]/Global.json`
  - Page/module-specific translations: `src/messages/[locale].json`
- **Configuration**:
  - `src/i18n-config.ts`: Defines supported locales, default locale, and locale detection settings.
  - `src/i18n.ts`: Uses `getRequestConfig` to load and merge `Global.json` (under a `Global` key) and page-specific messages.
  - `src/middleware.ts`: Handles locale detection and routing.
- **Layouts**:
  - Root layout (`src/app/[locale]/layout.tsx`):
    - Calls `setRequestLocale(currentLocale)` to set the active locale.
    - Fetches messages using `await getMessages({ locale: currentLocale })` and passes them to `NextIntlClientProvider`.
  - `src/components/layout/client-layout.tsx`: Contains the `NextIntlClientProvider` which makes translations available to Client Components.

## Usage

- **Server Components**:
  - Use `await getTranslations({ locale, namespace })`.
  - **Important**: Always explicitly pass the `locale` to `getTranslations` (e.g., `getTranslations({ locale: 'en', namespace: 'MyPage' })`) to ensure the correct language is loaded, especially in nested Server Components or pages. This prevents issues where `next-intl` might default to a different locale due to its internal request resolution.
- **Client Components**:
  - Use `useTranslations("Namespace")`. Messages are provided by `NextIntlClientProvider`.
- **Navigation**:
  - Use `Link` and `usePathname` from `@/i18n/navigation` for localized routing.

## Key Debugging Learnings & Fixes

During a debugging session for incorrect language display (English URL showing French content), the following was identified and resolved:

1.  **Issue**: `getMessages()` in the root layout (`src/app/[locale]/layout.tsx`) and `getTranslations()` in specific Server Components (e.g., `src/app/[locale]/profile/account/edit/page.tsx`) were sometimes resolving to the default locale (`fr`) despite the URL and `setRequestLocale` indicating the English locale (`en`). This was due to `next-intl` potentially invoking `getRequestConfig` multiple times, with one of these calls having an `undefined` `requestLocale` parameter.

2.  **Solution**: Explicitly pass the `locale` parameter to all calls of `getMessages()` and `getTranslations()`:

    - In `src/app/[locale]/layout.tsx`:
      ```typescript
      const messages = await getMessages({ locale: currentLocale });
      ```
    - In Server Components (e.g., `edit/page.tsx`):
      ```typescript
      const t = await getTranslations({ locale, namespace: "MyNamespace" });
      ```

    This ensures that these functions load messages for the intended locale, overriding any potential fallback to the default locale caused by intermediate `getRequestConfig` calls with an undefined locale.

## Conventions

- Namespaces: `PascalCase`
- Translation Keys: `camelCase`
