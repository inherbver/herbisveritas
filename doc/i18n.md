# Documentation : Internationalisation (i18n)

Ce document est le guide de référence pour l'internationalisation (i18n) du projet HerbisVeritas. Il explique l'architecture, les conventions et les procédures pour ajouter et gérer les traductions.

**Bibliothèque principale :** [`next-intl`](https://next-intl.dev/)

---

## 1. Guide Rapide : Ajouter une Traduction

Pour un développeur souhaitant ajouter ou modifier une traduction, voici le processus en 3 étapes :

1.  **Identifier le bon fichier de "namespace" :**

    - Les traductions sont dans `src/i18n/messages/[locale]/`.
    - Chaque fichier (ex: `HomePage.json`, `Global.json`) est un "namespace".
    - Choisissez le namespace le plus pertinent. Si aucun ne correspond, créez un nouveau fichier (ex: `NewFeature.json`) dans chaque dossier de locale (`en`, `fr`, etc.).

2.  **Ajouter la clé de traduction :**

    - Utilisez la convention `camelCase` pour la clé.
    - Ajoutez la paire `"maNouvelleCle": "Ma traduction"` dans les fichiers JSON de **toutes les langues**.
    - **Exemple dans `.../fr/Global.json`**: `"seeDetails": "Voir les détails"`
    - **Exemple dans `.../en/Global.json`**: `"seeDetails": "See details"`

3.  **Utiliser la traduction dans le code :**

    - **Server Component**:

      ```tsx
      import { getTranslations } from "next-intl/server";

      export default async function MyComponent() {
        const t = await getTranslations("Global"); // Charger le namespace
        return <p>{t("seeDetails")}</p>;
      }
      ```

    - **Client Component**:

      ```tsx
      "use client";
      import { useTranslations } from "next-intl";

      export default function MyComponent() {
        const t = useTranslations("Global"); // Le namespace doit être chargé par un parent
        return <p>{t("seeDetails")}</p>;
      }
      ```

---

## 2. Architecture Détaillée

### a. Structure des Fichiers

L'organisation des fichiers est la pierre angulaire de notre système i18n.

- **Répertoire principal :** `src/i18n/messages/`
- **Structure :** `[locale]/[NamespaceName].json`
  - `[locale]`: Code de la langue (ex: `en`, `fr`).
  - `[NamespaceName].json`: Fichier contenant les traductions pour un contexte spécifique (ex: `ProductPage.json`). Le nom du fichier, en `PascalCase`, définit le nom du namespace.

Chaque fichier JSON contient un objet plat de paires clé-valeur.

_Exemple : `src/i18n/messages/fr/ProductPage.json`_

```json
{
  "addToCart": "Ajouter au panier",
  "productDescription": "Description du produit",
  "relatedProducts": "Produits similaires"
}
```

### b. Configuration et Chargement

- **`src/i18n.ts`**: Ce fichier utilise `getRequestConfig` de `next-intl/server`. Il importe dynamiquement **tous** les fichiers `.json` de la locale demandée et les fusionne en un seul objet `messages`, où chaque clé de premier niveau est le nom du namespace.

- **`src/middleware.ts`**: Le middleware de `next-intl` gère la détection de la locale et la redirection. Il s'assure que chaque route est préfixée par la locale (ex: `/fr/accueil`). Pour plus de détails sur son rôle dans la sécurité, voir [SECURITY.md](./SECURITY.md).

- **`src/app/[locale]/layout.tsx`**: Le layout racine enveloppe l'application dans le `<NextIntlClientProvider>`. Il reçoit l'objet `messages` complet et le met à disposition de tous les Client Components de l'arbre.

### c. Conventions

- **Noms de Fichiers (Namespaces) :** `PascalCase` (ex: `CheckoutFlow.json`).
- **Clés de Traduction :** `camelCase` (ex: `billingAddress`).

---

## 3. Dépannage et Points d'Attention

Cette section, tirée de l'expérience, liste les problèmes courants et leurs solutions.

- **Erreur `FORMATTING_ERROR`**:

  - **Cause :** Une traduction attend une variable (ex: `"Bonjour {name}"`) mais elle n'est pas fournie à l'appel `t()`.
  - **Solution :** Toujours passer les variables attendues. `t('welcomeMessage', { name: 'Omar' })`.

- **Clés dupliquées dans un JSON**:

  - **Cause :** Un même fichier JSON contient deux fois la même clé.
  - **Solution :** Les linters JSON devraient détecter cela. Assurez une unicité stricte.

- **Confusion de portée avec `useTranslations`**:

  - **Cause :** `const t = useTranslations('Namespace.subKey')` puis `t('subKey.finalKey')`.
  - **Solution :** Le préfixe est déjà appliqué. Utilisez `t('finalKey')`.

- **Accès aux `props.params` dans Next.js 15+**:
  - **Cause :** Accès direct `props.params.locale` dans un Server Component.
  - **Solution :** Toujours utiliser `await`: `const { locale } = await props.params;`.

---

## 4. Évolutions Futures

- **Validation en CI :** Un script pour vérifier que toutes les clés existent dans toutes les langues.
- **Typage Fort :** Génération de types TypeScript à partir des JSON pour l'autocomplétion et la détection d'erreurs à la compilation.
