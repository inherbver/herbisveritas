# ------------- in-herbis-veritas .windsurfrules -------------
# 0. Contexte g√©n√©ral
0. Site e-commerce Next.js 15 (App Router + Server Components), React 18.2, TypeScript 5, h√©berg√© Supabase.  
0a. MCP actifs : Context7, Supabase, Dart (project manager). Windsurf ‚Üí Settings ‚Üí MCP confirme leur disponibilit√©.  üîó Context7 docs  üîó Supabase docs  üîó Dart MCP

# 1. Structure & conventions
1. Pages sous /app ; Server Components par d√©faut ; marquer 'use client' si n√©cessaire.  
2. Alias absolus : '@/components', '@/lib', '@/stores', '@/db', '@/types'.  
3. TS strict : `strict: true`, `noImplicitAny: true`.  
4. Imports relatifs limit√©s √† deux niveaux maxi.

# 2. Styling & UI
5. Tailwind 3 avec @import base, components, utilities ; content cible ./app & ./src.  
6. Composants = shadcn/ui ; commande CLI : `npx shadcn-ui@latest add`.  
7. Th√®mes via `data-slot` + Tailwind v4 compatibility.

# 3. Animation & accessibilit√©
8. Animations : Framer Motion (variants, layout).  
9. Respect WCAG 2.2 : aria-* obligatoires sur tout composant interactif.

# 4. State & formulaires
10. State global ‚Üí Zustand 4 ; d√©couper selectors, utiliser shallow.  
11. Formulaires : React Hook Form + Zod ; validation c√¥t√© client ET c√¥t√© serveur (Server Action).

# 5. Donn√©es & s√©curit√©
12. Supabase-js 2 : appels DB UNIQUEMENT dans Server Components/Route Handlers.  
13. RLS obligatoire sur chaque table ; politiques distinctes `anon` / `authenticated`.  
14. Interdiction d‚Äôexposer la cl√© `service_role`. Variables dans `.env.local`.

# 6. i18n & routes
15. next-intl pour fr, en, de, es ; fichiers JSON dans /messages.  
16. URLs publiques : /{locale}/‚Ä¶ ; locale par d√©faut = fr.

# 7. Performances
17. Dev : `next dev --turbo` ; analyse bundle `next build --profile`.  
18. `export const dynamic = "force-dynamic"` uniquement si n√©cessaire.  
19. Favoriser Edge Runtime (revalidateTag) pour fonctions l√©g√®res.

# 8. Tests & CI
20. Jest unitaires dans __tests__, Cypress e2e dans cypress/.  
21. Workflow GitHub : `npm run lint && npm run test && npm run build`.

# 9. MCP directives sp√©cifiques
22. Context7 : chaque prompt complexe doit inclure le tag `use context7` pour injecter docs live (Next 15, Supabase, shadcn/ui‚Ä¶).  
23. Supabase MCP : activer l‚Äôaction ‚ÄúrowLevelSecurityCheck‚Äù avant tout commit touchant `/supabase/`.  
24. Dart MCP :  
    ‚Ä¢ `createTask` quand un TODO > 30 mn est d√©tect√© dans le diff ;  
    ‚Ä¢ `updateTask` sur push si commit message contient `#task-<id>`.

# 10. R√©pertoires prot√©g√©s
25. Ne JAMAIS √©diter `/public`, `/supabase/migrations`, `/node_modules`.

# 11. Commits & documentation
26. Convention commit : `type(scope): description` (ex. feat(cart): optimistic update).  
27. Commentaires ¬´ why ¬ª requis si > 20 lignes chang√©es.

# 12. AI guidelines
28. Cascade doit proposer : snippet + explication + source Context7.  
29. Si Cascade manque de contexte, d√©clencher automatiquement `use context7`.

# ------------- end .windsurfrules -------------
