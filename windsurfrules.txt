# ------------- in-herbis-veritas .windsurfrules -------------
# 0. Contexte gÃ©nÃ©ral
0. Site e-commerce Next.js 15 (App Router + Server Components), React 18.2, TypeScript 5, hÃ©bergÃ© Supabase.  
0a. MCP actifs : Context7, Supabase, Dart (project manager). Windsurf â†’ Settings â†’ MCP confirme leur disponibilitÃ©.  ğŸ”— Context7 docs  ğŸ”— Supabase docs  ğŸ”— Dart MCP

# 1. Structure & conventions
1. Pages sous /app ; Server Components par dÃ©faut ; marquer 'use client' si nÃ©cessaire.  
2. Alias absolus : '@/components', '@/lib', '@/stores', '@/db', '@/types'.  
3. TS strict : `strict: true`, `noImplicitAny: true`.  
4. Imports relatifs limitÃ©s Ã  deux niveaux maxi.
4a. Layout Racine (`app/layout.tsx`): Placer `<body>` immÃ©diatement aprÃ¨s `<html>` (ex: `<html><body>...</body></html>`) SANS espace, commentaire ni retour Ã  la ligne pour Ã©viter l'erreur d'hydratation "whitespace text node".

# 2. Styling & UI
5. Tailwind 3 avec @import base, components, utilities ; content cible ./app & ./src.  
6. Composants = shadcn/ui ; commande CLI : `npx shadcn-ui@latest add`.  
7. ThÃ¨mes via `data-slot` + Tailwind v4 compatibility.
[Rule 2025-04-27] Avoid using @apply with non-existent classes in Tailwind CSS
- When using @apply in CSS files, ensure the class exists in Tailwind's generated CSS.
- If a class like 'outline-ring/50' is not generated by Tailwind, replace @apply with direct CSS properties (e.g., 'outline-color: color-mix(in oklab, var(--ring) 50%, transparent)') to prevent build errors.
- Always check the generated CSS in DevTools to confirm utility classes are present before using them with @apply.

# 3. Animation & accessibilitÃ©
8. Animations : Framer Motion (variants, layout).  
9. Respect WCAG 2.2 : aria-* obligatoires sur tout composant interactif.

# 4. State & formulaires
10. State global â†’ Zustand 4 ; dÃ©couper selectors, utiliser shallow.  
11. Formulaires : React Hook Form + Zod ; validation cÃ´tÃ© client ET cÃ´tÃ© serveur (Server Action).

# 5. DonnÃ©es & sÃ©curitÃ©
12. Supabase-js 2 : appels DB UNIQUEMENT dans Server Components/Route Handlers.  
13. RLS obligatoire sur chaque table ; politiques distinctes `anon` / `authenticated`.  
14. Next.js 15 dynamic APIs : `params` et `searchParams` sont dÃ©sormais asynchrones ; en Server Components, await avant dÃ©structuration (ex : `const { locale } = await params;`), en Client Components, unwrap avec `React.use(params)`.
15. Interdiction dâ€™exposer la clÃ© `service_role`. Variables dans `.env.local`.

# 6. i18n & routes
16. next-intl pour fr, en, de, es ; fichiers JSON dans /messages.  
17. URLs publiques : /{locale}/â€¦ ; locale par dÃ©faut = fr.

# 7. Performances
18. Dev : `next dev --turbo` ; analyse bundle `next build --profile`.  
19. `export const dynamic = "force-dynamic"` uniquement si nÃ©cessaire.  
20. Favoriser Edge Runtime (revalidateTag) pour fonctions lÃ©gÃ¨res.

# 8. Tests & CI
21. Jest unitaires dans __tests__, Cypress e2e dans cypress/.  
22. Workflow GitHub : `npm run lint && npm run test && npm run build`.

# 9. MCP directives spÃ©cifiques
23. Context7 : chaque prompt complexe doit inclure le tag `use context7` pour injecter docs live (Next 15, Supabase, shadcn/uiâ€¦).  
24. Supabase MCP : activer lâ€™action â€œrowLevelSecurityCheckâ€ avant tout commit touchant `/supabase/`.  
25. Dart MCP :  
    â€¢ `createTask` quand un TODO > 30 mn est dÃ©tectÃ© dans le diff ;  
    â€¢ `updateTask` sur push si commit message contient `#task-<id>`.

# 10. RÃ©pertoires protÃ©gÃ©s
26. Ne JAMAIS Ã©diter `/public`, `/supabase/migrations`, `/node_modules`.

# 11. Commits & documentation
27. Convention commit : `type(scope): description` (ex. feat(cart): optimistic update).  
28. Commentaires Â« why Â» requis si > 20 lignes changÃ©es.

# 12. AI guidelines
29. Cascade doit proposer : snippet + explication + source Context7.  
30. Si Cascade manque de contexte, dÃ©clencher automatiquement `use context7`.

# ------------- end .windsurfrules -------------
